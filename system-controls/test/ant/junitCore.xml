<?xml version="1.0"?>

<project name="Beehive/SystemControls/JUnitTests" basedir=".">

    <import file="test-imports.xml"/>

    <path id="test.classpath">
        <path refid="junit-tests.dependency.path"/>
        <path refid="junit.dependency.path"/>
        <path refid="servlet.dependency.path"/>
    </path>

    <target name="run.tests">
        <fail unless="formatter.type" message="Unspecified value for formatter.type"/>
        <fail unless="testout.dir" message="Unspecified value for testout.dir"/>
        <fail unless="fail" message="Unspecified value for fail"/>

        <property name="classpath" refid="test.classpath"/>
        <echo>test.classpath: ${classpath}</echo>

        <property name="show.output" value="false"/>

        <condition property="log4j.config" value="${log4jconfig.verbose.junit}">
            <not><isset property="log4j.quiet"/></not>
        </condition>
        <condition property="log4j.config" value="${log4jconfig.junit}">
            <and><isset property="log4j.quiet"/></and>
        </condition>

        <echo>log4j.config: ${log4j.config}</echo>
        <echo>testout.dir: ${testout.dir}</echo>

        <mkdir dir="${testout.dir}"/>

        <junit printsummary="${fail}" fork="${fail}" haltonfailure="${fail}" haltonerror="${fail}" showOutput="${show.output}">
            <jvmarg value="-ea"/>
            <classpath refid="test.classpath"/>
            <formatter type="${formatter.type}"/>
            <sysproperty key="log4j.configuration" value="file:${log4j.config}"/>
            <sysproperty key="systemcontrolsdrt.logdir" path="${testout.dir}"/>
            <sysproperty key="derby.system.home" value="${testout.dir}"/>

            <test name="org.apache.beehive.controls.system.jdbc.units.dbconnection.DBConnectionTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.sqlparser.SqlParserTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.DBSingleRowResultsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.DBMultiRowResultsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.StoredProcsDBResultsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.TxResultsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.XmlBeanResultsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.results.JdbcTypesTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.errors.ErrorPathsTest" todir="${testout.dir}"/>
            <test name="org.apache.beehive.controls.system.jdbc.units.JdbcControlSerializationTest" todir="${testout.dir}"/>

        </junit>

        <echo>Generating a test report into: ${testout.dir}/html</echo>

        <mkdir dir="${testout.dir}/html"/>

        <!-- build a report -->
        <junitreport todir="${testout.dir}/">
            <fileset dir="${testout.dir}/">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="noframes" todir="${testout.dir}/html"/>
        </junitreport>
    </target>

    <target name="run.test">
        <fail unless="test.name" message="No test specified, set the -Dtest.name=&lt;name&gt; property"/>
        <java classpathref="test.classpath" classname="${test.name}"/>
    </target>

</project>
